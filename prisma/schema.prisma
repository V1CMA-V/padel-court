// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Player {
  id              String   @id @unique
  email           String   @unique
  name            String?
  preferredHand   String?
  preferredSide   String?
  profileImageUrl String?
  colorSchema     String?  @default("theme-orange")
  createdAt       DateTime @default(now())

  ownedTeams      Team[]   @relation("TeamOwner")
  teammateTeams   Team[]   @relation("TeamMate")
}

model Team {
  id        String     @id @default(uuid())
  status    String?    @default("ACTIVE")
  createdAt DateTime   @default(now())

  ownerName      String?
  ownerId   String?
  owner     Player?     @relation("TeamOwner", fields: [ownerId], references: [id])

  teammateName String?
  teammateId   String?
  teammate     Player?   @relation("TeamMate", fields: [teammateId], references: [id])


  enrollments  TeamEnrollment[]
  matchTeams   MatchTeam[]
  LeagueTeamStats LeagueTeamStats[]
}

enum TeamMemberRole {
  OWNER
  MEMBER
}

model Club {
  id          String   @id @unique
  name        String   @unique
  email       String   @unique
  plan        String   @default("free")
  colorSchema String?  @default("theme-orange")

  phoneNumber String?
  description String?
  logoUrl     String?
  sitioWeb    String?
  aditionalServices String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  courts      Court[]
  locations   Location[]

  tournaments Tournament[]
  leagues     League[]
}

model Location {
  id        String   @id @default(uuid())

  clubId    String?  @unique
  club      Club?     @relation(fields: [clubId], references: [id])

  address   String
  state     String
  country   String
  zipCode   String
  googleMapsUrl String?

  createdAt DateTime @default(now())
}

model Court {
  id        String   @id @default(uuid())
  name      String
  isIndoor  Boolean  @default(true)
  isAvailable Boolean  @default(true)

  clubId    String
  club      Club     @relation(fields: [clubId], references: [id])
  matches   Match[]

  createdAt DateTime @default(now())
}

enum TournamentStatus {
  DRAFT
  OPEN
  ONGOING
  FINISHED
  CANCELED
}


model Tournament {
  id          String   @id @default(uuid())
  slug        String   @unique
  name        String
  description String?
  startDate   DateTime
  endDate     DateTime
  status      TournamentStatus @default(DRAFT)
  capacity    Int?
  registrationFee Float
  format      String?
  rules       String?
  prize1st    String?
  prize2nd    String?
  prize3rd    String?

  createdAt   DateTime @default(now())

  clubId String
  club   Club   @relation(fields: [clubId], references: [id])


  categories Category[]
  matches    Match[]
  enrollments TeamEnrollment[]
  scheduled  Scheduled[]
}

model League {
  id        String   @id @default(uuid())
  name      String
  season    String
  createdAt DateTime @default(now())

  clubId String
  club   Club   @relation(fields: [clubId], references: [id])

  teams   LeagueTeamStats[]
  matches Match[]
}

model LeagueTeamStats {
  id String @id @default(uuid())

  leagueId String
  teamId   String

  matchesWon  Int @default(0)
  matchesLost Int @default(0)
  setsWon     Int @default(0)
  setsLost    Int @default(0)

  league League @relation(fields: [leagueId], references: [id])
  team   Team   @relation(fields: [teamId], references: [id])

  @@unique([leagueId, teamId])
}

model Category {
  id          String   @id @default(uuid())
  name        String
  description String?

  prize1st String?
  prize2nd String?
  prize3rd String?

  tournamentId String
  tournament   Tournament @relation(fields: [tournamentId], references: [id])

  matches     Match[]
  teamEnrollments TeamEnrollment[]
}

enum EnrollmentStatus {
  PENDING
  PAID
  CANCELED
  REJECTED
  APPROVED
}

model TeamEnrollment {
  id           String @id @default(uuid())
  teamId       String
  tournamentId String
  categoryId   String

  withMatch    Boolean @default(false)

  status       EnrollmentStatus @default(PENDING)

  createdAt    DateTime @default(now())

  team       Team       @relation(fields: [teamId], references: [id])
  tournament Tournament @relation(fields: [tournamentId], references: [id])
  category   Category   @relation(fields: [categoryId], references: [id])

  @@unique([teamId, tournamentId])
}

enum MatchRound {
  GROUP
  QF
  SF
  FINAL
}

enum MatchStatus {
  SCHEDULED
  ONGOING
  COMPLETED
  CANCELED
}

model Match {
  id        String    @id @default(uuid())
  round     MatchRound
  scheduled DateTime?
  status    MatchStatus @default(SCHEDULED)
  createdAt DateTime  @default(now())

  categoryId String
  courtId    String?
  tournamentId String

  category Category @relation(fields: [categoryId], references: [id])
  court    Court?    @relation(fields: [courtId], references: [id])
  tournament Tournament @relation(fields: [tournamentId], references: [id])

  leagues     League[]
  teams  MatchTeam[]
  result MatchResult?
}

model MatchTeam {
  id       String @id @default(uuid())
  position Int    // 1 o 2

  matchId String
  teamId  String

  match Match @relation(fields: [matchId], references: [id])
  team  Team  @relation(fields: [teamId], references: [id])

  @@unique([matchId, teamId])
  @@unique([matchId, position])
}

model MatchResult {
  id        String   @id @default(uuid())
  score     String
  winner    Int      // position ganador: 1 o 2
  createdAt DateTime @default(now())

  matchId String @unique
  match   Match  @relation(fields: [matchId], references: [id])
}

model Scheduled {
  id        String   @id @default(uuid())
  date      DateTime
  event     String
  time      String
  createdAt DateTime @default(now())

  tournamentId String
  tournament   Tournament @relation(fields: [tournamentId], references: [id])

}
